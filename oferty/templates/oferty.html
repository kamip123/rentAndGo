<!DOCTYPE html>

<script>

</script>
<html lang="pl">
<html>
<head>
    {% load static %}
    <link rel="stylesheet" href="{% static 'oferty/css/oferty.css' %}">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.2/css/all.css"
          integrity="sha384-/rXc/GQVaYpyDdyxK+ecHPVYJSN9bmVFBvjA/9eOB+pb3F2w2N6fc5qB9Ew5yIns"
          crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.13/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-resource@1.5.1"></script>

    <script>
			$(window).resize(function () {
				var viewportWidth = $(window).width();
				if (viewportWidth <= 991) {
						$("#searchMenu").removeClass("sticky-top");
				}
				else {
					$("#searchMenu").addClass("sticky-top");
				}
			});


    </script>

</head>

<body style="background-color:#0C6291">
<div class="container-fluid" id="topBar">
    <div class="wrapper">
        <div class="row" style="margin-left:0px;margin-right:0px;">
            <div class="col-12 col-md-6 col-lg-4 float-lg-left" style="background-color:darkred;">
                <img src="{% static 'stronaGlowna/assets/company_logo.png' %}" alt="Logo" style="width:300px">
            </div>
            <div class="col-0 col-md-2 col-lg-4 float-lg-right" style="background-color:#0C6291;">

            </div>
            <div class="col-6 col-md-2 float-lg-right" style="background-color:#4E8CAF;">
                <p>test@gmail.com</p>
            </div>

            <div class="col-6 col-md-2 float-lg-right" style="background-color:#4E8CAF;">
                <p>+48 68 259 56 78</p>
            </div>
        </div>
    </div>
</div>
<div class="container-fluid" id="form" style="background-color: #343a40;">
    <div class="wrapper">
        <nav class="navbar navbar-expand-md navbar-dark bg-dark">

            <li class="nav-item">
                <a class="navbar-brand" href="../"><i class="fa fa-home fa-1x"></i> Home</a>
            </li>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarUniversity"
                    aria-controls="navbarUniversity" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarUniversity">
                <ul class="navbar-nav mr-auto">

                    <li class="nav-item">
                        <a class="nav-link" href="../oferty/"><i class="fa fa-car fa-1x"></i> Offerts</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../kierowca/"><i class="fa fa-id-card fa-1x"></i> Driver</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../informacje/"><i class="fa fa-info-circle fa-1x"></i> Info</a>
                    </li>
                    {% if user.is_authenticated %}
                    <li class="nav-item">
                        <a class="nav-link" href="../zamowienia/"><i class="fa fa-credit-card fa-1x"></i> Your
                            orders</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../profil/"><i class="fa fa-user-cog fa-1x"></i> Your profil</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../wyloguj/"><i class="fa fa-sign-out-alt fa-1x"></i> Log out</a>
                    </li>
                    {% else %}
                    <li class="nav-item">
                        <a class="nav-link" href="../zarejestruj/"><i class="fa fa-user-plus fa-1x"></i> Sing in</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../zaloguj/"><i class="fa fa-sign-in-alt fa-1x"></i> Log in</a>
                    </li>
                    {% endif %}
                </ul>
            </div>

        </nav>
    </div>
    <div class="container-fluid" id="offertsContainer">
    <div class="wrapper">
        <div id="oferty" class="row p-1">
            <div id="searchMenu" class="col-12 col-md-12 col-lg-3 sticky-top"
                 style="height:100%;margin-top:30px;background-color:rgba(23, 106, 191, 0.95);margin-bottom:10px;border-style: solid;border-color:darkred;">
                <h3 style="text-align: center;padding-top:10px;color:white;"><span
                        style="background-color:darkred;padding:5px;font-size: 25px;">Wyszukiwarka</span></h3>

                <div class="row" style="padding-top:5px;">
                    <div class="col-12">
                        <p style="background-color:darkred;padding:5px;font-size: 15px;color:white;">Marka</p>
                    </div>
                    <div class="col-12">
                        <input v-model="marka" id="carName" type="text" list="carNames" placeholder="skoda"
                               name="hidden">
                        <datalist id="carNames">
                        </datalist>
                    </div>
                </div>

                <div class="row" style="padding-top:5px;">
                    <div class="col-12">
                        <p style="background-color:darkred;padding:5px;font-size: 15px;color:white;">Typ</p>
                    </div>
                    <div class="col-12">
                        <input v-model="typ" id="carType" type="text" list="carTypes" placeholder="osobowe"
                               name="hidden">
                        <datalist id="carTypes">
                        </datalist>
                    </div>
                </div>

                <div class="row" style="padding-top:5px;">
                    <div class="col-12">
                        <p style="background-color:darkred;padding:5px;font-size: 15px;color:white;">Cena</p>
                    </div>
                    <div class="col-6">
                        <input v-model="cenaOd" type="number" class="form-control" id="cenaOd">
                    </div>
                    <div class="col-6">
                        <input v-model="cenaDo" type="number" class="form-control" id="cenaDo">
                    </div>
                    <div class="col-12">
                        <div class="row">
                            <div class="col-12"><input v-model="cenaDo" type="range" min="1" max="1000" value="150"
                                                       class="slider"
                                                       id="cenaRange"></div>
                            <div class="col-6"><span id="cenaLeft">0</span></div>
                            <div class="col-6 float-right text-right"><span id="cenaRight">1000</span></div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12" style="padding-top:5px;">
                        <p style="background-color:darkred;padding:5px;font-size: 15px;color:white;">Spalanie</p>
                    </div>
                    <div class="col-6">
                        <input v-model="spalanieOd" type="number" class="form-control" id="spalanieOd">
                    </div>
                    <div class="col-6">
                        <input v-model="spalanieDo" type="number" class="form-control" id="spalanieDo">
                    </div>
                    <div class="col-12">
                        <div class="row">
                            <div class="col-12"><input v-model="spalanieDo" type="range" min="1" max="50" value="10"
                                                       class="slider"
                                                       id="spalanieRange"></div>
                            <div class="col-6"><span id="spalanieLeft">0</span></div>
                            <div class="col-6 float-right text-right"><span id="spalanieRight">50</span></div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12" style="padding-bottom:10px;">
                        <button onclick="searchOferts()">Szukaj</button>
                    </div>
                </div>

            </div>
            <div class="col-0 col-sm-0 col-md-1"></div>
            <div class="row col-12 col-md-12 col-lg-8 opisGlowny text-center">

                <div class="col-12">
                    <table id="table" v-for="samochod in sortedSamochody">
                        <tr class="carOffertRow">
                            <th class="carOfferCell">
                                <img src="http://onsurga.com/wp-content/uploads/2011/11/Bugatti-Veyron-16.4-Super-Sport.jpg"
                                     style="height:250px;width:250px;"/>
                            </th>
                            <th class="carOfferCell">
                                <p>Name: [[ samochod.marka ]]</p>
                                <p>Type: [[ samochod.typ ]]</p>
                                <p>Price: [[ samochod.cena ]]</p>
                                <table style="width:100%;">
                                    <tr class="carOffertRow">
                                        <th class="carOfferCell"><img
                                                src="{% static 'stronaGlowna/assets/ilosc_drzwi.png' %}"
                                                alt="Italian Trulli"/> [[ samochod.ilosc_drzwi ]]
                                        </th>
                                        <th class="carOfferCell"><img
                                                src="{% static 'stronaGlowna/assets/solid--big-bag.png' %}"
                                                alt="Italian Trulli"/> [[ samochod.walizki ]]
                                        </th>
                                    </tr>
                                    <tr class="carOffertRow">
                                        <th class="carOfferCell"><img
                                                src="{% static 'stronaGlowna/assets/solid--air-conditioning.png' %}"
                                                alt="Italian Trulli"/> [[ samochod.klimatyzacja ]]
                                        </th>
                                        <th class="carOfferCell"><img
                                                src="{% static 'stronaGlowna/assets/solid--car-seat.png' %}"
                                                alt="Italian Trulli"/> [[ samochod.ilosc_miejsc ]]
                                        </th>
                                    </tr>
                                </table>
                            </th>
                            <th class="carOffertEndCell">
                                <p><img src="{% static 'stronaGlowna/assets/paliwo.png' %}"
                                        alt="Italian Trulli"/> Fuel type: [[ samochod.rodzaj_paliwa ]]</p>
                                <p><img src="{% static 'stronaGlowna/assets/paliwo.png' %}"
                                        alt="Italian Trulli"/> Combustion: [[ samochod.spalanie ]]</p>
                                <p><img src="{% static 'stronaGlowna/assets/solid--car-gears.png' %}"
                                        alt="Italian Trulli"/> [[ samochod.skrzynia_biegow ]]</p>
                                <p><a :href="[[ samochod.id ]]" class="przyciskRent">Rent</a></p>
                            </th>
                        </tr>
                    </table>
                    <div class="col-12 p-2">
                        <button @click="prevPage" :disabled="!(currentPage > 1)">PREV</button>

                        <span style="margin: 40px;"> Current Page: [[ currentPage ]] </span>

                        <button @click="nextPage" :disabled="!((currentPage * pageSize) < szukaneSamochody.length)">NEXT
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    <script>
				Vue.http.headers.common['X-CSRFToken'] = "{{ csrf_token }}";

				new Vue({
					delimiters: ['[[', ']]'],
					el: '#oferty',
					data: {
						cenaOd: 1,
						cenaDo: 1000,
						marka: null,
						typ: null,
						spalanieOd: 1,
						spalanieDo: 50,
						samochody: [],
						szukaneSamochody: [],
						currentPage: 1,
						pageSize: 2,
						currentSortDir: "desc",
						currentSort: "price"
					},
					mounted: function () {
						this.getData()
					},
					watch: {
						cenaOd: function (val) {
							this.currentPage = 1;
						},
						cenaDo: function (val) {
							this.currentPage = 1;
						},
						marka: function (val) {
							this.currentPage = 1;
						},
						typ: function (val) {
							this.currentPage = 1;
						},
						spalanieOd: function (val) {
							this.currentPage = 1;
						},
						spalanieDo: function (val) {
							this.currentPage = 1;
						}
					},
					methods: {
						getData() {
							this.$http.get('/api/samochod/')
								.then(response => {
									this.samochody = response.data;
									this.szukaneSamochody = response.data;
									console.log(response)
								})
								.catch(error => {
									console.error(error)
								})
						},
						sort(s) {
							if (s === this.currentSort) {
								this.currentSortDir = this.currentSortDir === 'desc' ? 'asc' : 'desc';
							}

							this.currentSort = s;
						},
						prevPage() {
							this.currentPage--;
						},
						nextPage() {
							this.currentPage++;
						}
					},
					computed: {
						sortedSamochody(){
							this.szukaneSamochody = this.samochody.filter(samochod => {
								if(samochod.cena < this.cenaOd) return false;
								if(samochod.cena > this.cenaDo) return false;
								if(samochod.spalanie < this.spalanieOd) return false;
								if(samochod.spalanie > this.spalanieDo) return false;
								if(this.marka != null){
									if(!samochod.marka.toLowerCase().match(this.marka.toLowerCase())) return false;
								}
								if(this.typ != null){
									if(!samochod.typ.toLowerCase().match(this.typ.toLowerCase())) return false;
								}
								return samochod;
							});
							return this.szukaneSamochody.sort((samochod1, samochod2) => {
								let modifier = 1;
								if (this.currentSortDir === 'desc') modifier = -1;
								if (this.currentSort === 'price') {
									if (samochod1.cena < samochod2.cena) return -1 * modifier;
									if (samochod1.cena > samochod2.cena) return 1 * modifier;
								}
								return 0;
							}).filter((row, index) => {
								let start = (this.currentPage - 1) * this.pageSize;
								let end = this.currentPage * this.pageSize;
								if (index >= start && index < end) return true;
							});
						}
					}
				});


    </script>

</div>

<footer>
    <div class="container-fluid" style="text-align:left;background-color:#0c6291;">
        <div class="row">
            <div class="col-0 col-sm-3"></div>
            <div class="col-12 col-sm-6" style="margin-top:5px;">
                <p style="font-size:10px">Copyright © 2018 rent&amp;go.com, marka należąca do Grupy AKK(aleksander,
                    kamil, kuba) Limited. Wszelkie prawa zastrzeżone.</p>
                <p style="font-size:10px">Contact information: <a
                        href="mailto:someone@example.com">someone@example.com</a>.</p>
                <table class="text-center" style="margin-top:10px;margin-bottom:10px;">
                    <tr>
                        <th style="font-size:10px;border:0px solid #640000;border-right:2px solid #640000;"><a
                                href="/kontakt/kontakt">Contact</a></th>
                        <th style="font-size:10px;border:0px solid #640000;border-right:2px solid #640000;"><a
                                href="/kontakt/cookies">Cookies</a></th>
                        <th style="font-size:10px;border:0px solid #640000;"><a href="/kontakt/zasady">Rules</a></th>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</footer>

</body>
</html>
